// Testing this in scripts

// event_tnn_brandingSequence01(script_type)
// Introduction to Game!

// Bhroom Note: Janos is the branding duergar and Kim is the punching duergar.  Lucretia and Ox simply watch from the vantage point

// GZ NOTE: This script is only run if "sceneBrandingStart" is equal to 1
if (argument0 == SCRIPT_START)
{
    if (scr_quest_get_state("sceneBrandingStart") != 1)
    {
    
        with (o_dwarf1) { instance_destroy(); }
        with (o_babalugats01) { instance_destroy(); }
        with (o_dwarf3) { instance_destroy(); }
        with (o_dwarf4) { instance_destroy(); }
        with (o_dragline01) { instance_destroy(); }
        with (o_dwarf6) { instance_destroy(); }
        with (o_janos01) { instance_destroy(); }
        
        if (instance_exists(o_kim01))
        {
            with (o_kim01)
            {
                scr_event_set_object(id, 264, 696);
                scr_entity_look(id, SOUTHEAST);
            }
        }
        if (instance_exists(o_lucretia01))
        {
            with (o_lucretia01)
            {
                scr_event_set_object(id, 440, 880);
                scr_entity_look(id, SOUTHWEST);
            }
        }
        if (instance_exists(o_ox01))
        {
            with (o_ox01)
            {
                scr_event_set_object(id, 232, 1160);
                scr_entity_look(id, SOUTHEAST);
            }
        }
        /*
        with (o_dwarf1) { instance_destroy(); }
        with (o_dwarf1) { instance_destroy(); }
        with (o_dwarf1) { instance_destroy(); }
        */
    }
    else
    {
        Quest("sceneBrandingStart", 2); //Wilmers room looks for this to be 2 to start his cinema
        
        scr_equipment_guns_bandolier_clear();
        scr_equipment_guns_bag_clear();
        
        //Kim background walking event
        with (o_kim01)
        {
            var duergar = id;
            _walking_background_event = scr_event_create_background();
            with (_walking_background_event) {
                scr_event_build_move_ext(duergar, 0, 64, MOVE_SLOW);
                scr_event_build_wait_for_actions();
                scr_event_build_look(duergar, SOUTHWEST);
                scr_event_build_wait(1);
                scr_event_build_move_ext(duergar, 0, -64, MOVE_SLOW);
                scr_event_build_wait_for_actions();
                scr_event_build_look(duergar, SOUTHWEST);
                scr_event_build_wait(1);
                scr_event_build_move_ext(duergar, 0, -48, MOVE_SLOW);
                scr_event_build_wait_for_actions();
                scr_event_build_look(duergar, SOUTHWEST);
                scr_event_build_wait(1);
                scr_event_build_move_ext(duergar, 0, 48, MOVE_SLOW);
                scr_event_build_wait_for_actions();
                scr_event_build_look(duergar, SOUTHWEST);
                scr_event_build_wait(1);
                scr_event_build_event_snippet(duergar._walking_background_event);
            }
            scr_event_advance(_walking_background_event);
        }
    
        // Build Event
        scr_entity_look(o_janos01, SOUTHEAST);
        var queX = o_janos01.x - 40;
        var queY = o_janos01.y;
        var event = scr_event_create_main();
        with (event) {
            // Textbox options for cutscene.
            //var text_options = scr_event_dialogue_build_extras(NULL, NULL, NULL, 3, NULL, NULL, NULL, NULL_STRING, NULL_STRING, NULL, NULL, false);
            //var tv_text = scr_event_dialogue_build_extras(144, 64, 220, 4, 1, NULL, NULL, NULL_STRING, NULL_STRING, NULL, NULL, false);
            //var slow_text_options = scr_event_dialogue_build_extras(NULL, NULL, NULL, 3, 1, NULL, NULL, NULL_STRING, NULL_STRING, NULL, NULL, false);
            
    // The camera is at the top of the map and gradually pans down the line until it gets to Hoopz, showing off the entire line. 
    // After it pans down, it locks onto Hoopz and stays there.
            //scr_event_build_fade(true, 0);
            scr_event_build_animation_set(o_tv, "face");
            scr_event_build_animation_set(o_tv2, "face");
            scr_event_build_animation_set(o_janos01, "brandingStand");
            scr_event_build_camera_move_to_point(o_janos01.x + 40, o_janos01.y + 200, 9999);
            scr_event_build_set_object(o_cts_hoopz, 288, 824); // moves o_cts_hoopz to the proper coordinates
            scr_event_build_set_object(o_dwarf1, queX, queY);
            scr_event_build_look(o_cts_hoopz, NORTH);
            scr_event_build_wait_for_actions();
            //scr_event_build_fade(false, 3.6);
            scr_event_build_wait(1.5);
            scr_event_build_camera_frame(CAMERA_NORMAL, o_tv);//, o_janos01);
            
            scr_event_build_wait_for_actions();
    // On the right side of the screen where there's opening an opening, one duergar patrols up and down.
            //scr_event_build_wait(1);
            //face for tv was here
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "Congratulations, lucky dwarfs! You've been selected by the benevolent A.I. Cuchulainn to live in the fabulous Tir na Nog, the upscale, ultra-modern arcology located here in the luxurious space ziggurat Necron 7...");
            scr_event_build_animation_set(o_tv, "sunset");
            scr_event_build_animation_set(o_tv2, "sunset");
            scr_event_build_camera_frame(CAMERA_NORMAL, o_janos01); //move_to_point(o_janos01.x, o_janos01.y, CAMERA_SLOW);
            scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Janos", "s_port_janos", "NEXT!");
            scr_event_build_wait(.5);
            // All NPCs, including Hoopz, shuffle up a few squares. The ones at the head of the line walk off the top of the map.
            scr_event_build_move_ext(o_dwarf1, 0, -140, MOVE_FAST); //was 82
            scr_event_build_wait(.1);
            scr_event_build_move_to_point(o_dwarf3, queX, queY);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dwarf4, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dwarf6, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_cts_hoopz, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_babalugats01, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dragline01, 0, -32);
            scr_event_build_wait_for_actions();
            scr_event_build_destroy_object(o_dwarf1);
            scr_event_build_camera_frame(CAMERA_FAST, o_cts_hoopz);
            scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Dragline", s_port_dragline, "This... this is it! I've been waiting for this my whole life! We're finally in Tir na Nog!");
            //scr_event_build_camera_frame(CAMERA_SLOW, o_babalugats01);
            //scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Babalugats", s_port_babalugats, "I don't want to be here... I'm scared and I just want to go home... I don't like Cuchulainn...");
            scr_event_build_camera_frame(CAMERA_FAST, o_janos01);
            scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Janos", "s_port_janos", "NEXT! Get movin' you lazy sacks of...");
            scr_event_build_wait(.5);
    // All NPCs, including Hoopz, shuffle up a few squares, The one at the head of the line walks off the top of the map.
            scr_event_build_move_ext(o_dwarf3, 0, -140, MOVE_FAST);
            scr_event_build_wait(.1);
            scr_event_build_move_to_point(o_dwarf4, queX, queY);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dwarf6, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_cts_hoopz, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_babalugats01, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dragline01, 0, -32);
            scr_event_build_wait_for_actions();
            scr_event_build_destroy_object(o_dwarf3);
            scr_event_build_animation_set(o_tv, "face");
            scr_event_build_animation_set(o_tv2, "face");
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "... features many wonderful amenities, from all the fruit, grapes and prunes you can eat, to free, first-class housing to dozens of fun activities like weekly bingo and calisthenics, all provided free of charge by the generous and munificent Cuchulainn...");
            scr_event_build_animation_set(o_tv, "beach");
            scr_event_build_animation_set(o_tv2, "beach");
            scr_event_build_camera_frame(CAMERA_FAST, o_cts_hoopz); //o_dragline01, o_babalugats01);
            scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Dragline", s_port_dragline, "Weekly bingo and free grapes! I love bingo!! And I love Cuchulainn!");
            scr_event_build_dialogue("Babalugats", s_port_babalugats, "I do too... but I just want to go home...");
    // triggers Patrolling Duergar to stop at Small Dwarf
            scr_event_build_event_background_end(o_kim01.id);
            scr_event_build_look(o_kim01, SOUTHWEST);
            Emote("build", "exclamation", o_kim01, 0, 0);
            scr_event_build_wait(1.25);
            scr_event_build_dialogue("Kim", "s_port_kim", "What was that? What the hell was that!?");
            scr_event_build_move_to_point(o_kim01, o_babalugats01.x + 32 + 8 + 5, o_babalugats01.y - 64 + 6 - 2); //was + 32, then o_kim01.xstart, o_kim01.ystart + 16 (now bhroom added +5, -2 on suggest from laz)
            scr_event_build_wait_for_actions();
            scr_event_build_look(o_kim01, SOUTHWEST);
            scr_event_build_animation_set(o_babalugats01, "scared");
            scr_event_build_camera_frame(CAMERA_FAST, o_kim01, o_babalugats01);
            scr_event_build_wait_for_actions();
            //scr_event_build_animation_set(o_kim01, "stand");
            
            scr_event_build_dialogue("Babalugats", s_port_babalugats, "Wh-what?");
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "... truly Tir na Nog is the premiere intergalactic luxury vacation destination, and with our helpful Duergar assistants, waiting on hand and knee for your call, you never need to move a finger...");
            scr_event_build_dialogue("Kim", "s_port_kim", "Was that rebel talk I heard? Are you a plant? Hey boys, it looks like we've got a rebel on our hands!");
            scr_event_build_dialogue("Babalugats", s_port_babalugats, "I-I'm not a rebel...");
            scr_event_build_dialogue("Kim", "s_port_kim", "You wanna know what Cuchulainn does to rebels around here? You wanna know?!");
     // Duergar punches the small dwarf in the gut and tosses him out of the line. He lies there and does not get up.
            scr_event_build_animation_play_and_set(o_kim01, "punch0", "punch0s");
            scr_event_build_wait_for_actions();
            scr_event_build_sound_play("sn_fistpunch02");
            scr_event_build_animation_play_and_set(o_kim01, "punch1", "punch2");
            scr_event_build_animation_play_and_set(o_babalugats01, "punched", "hurt");
            scr_event_build_move_ext_backwards(o_babalugats01, -32, 0, MOVE_FAST);
            scr_event_build_animation_auto(o_babalugats01, 0);
            scr_event_build_wait_for_actions();
            scr_event_build_dialogue("Babalugats", s_port_babalugats_hurt, "Ugh...");
            scr_event_build_dialogue("Kim", "s_port_kim", "That's what we do to rebels around here! Let that be a lesson to all of you - mess with Cuchulainn, get out of line, and you deal with us!");
     // Patrolling duergar goes back to walking up and down the empty area.
            scr_event_build_move_to_point(o_kim01, o_kim01.xstart, o_kim01.ystart);
            scr_event_build_wait_for_actions();
            scr_event_build_look(o_kim01, SOUTHWEST);
            scr_event_build_camera_frame(CAMERA_FAST, o_janos01);
            scr_event_build_dialogue("Janos", "s_port_janos", "NEXT! Get a move on, slackers!");
            scr_event_build_event_background_start(o_kim01._walking_background_event);
     // All NPCs move up besides the displaced Small Dwarf hike up, delete odwarf4 moments later
            //scr_event_build_camera_move(0, -64, 3);
            scr_event_build_move_ext(o_dwarf4, 0, -140, MOVE_FAST);
            scr_event_build_wait(.1);
            scr_event_build_flip(o_dwarf6, -1);
            scr_event_build_move_to_point(o_dwarf6, queX, queY); // Move to Janos
            scr_event_build_move(o_dragline01, 0, -48);
            scr_event_build_wait(.1);
            scr_event_build_move(o_cts_hoopz, 0, -32);
            scr_event_build_wait(.1);
            //scr_event_build_camera_frame(CAMERA_FAST, o_cts_hoopz);
            //scr_event_build_wait_for_actions();
            //scr_event_build_dialogue("Dragline", s_port_toughDwarf, "That's me! I'm finally getting in!"); //How does this work with how the scene is going?
            //scr_event_build_wait_for_actions();
            ////scr_event_build_destroy_object(o_dwarf4);
            scr_event_build_animation_set(o_tv, "face");
            scr_event_build_animation_set(o_tv2, "face");
            scr_event_build_camera_frame(CAMERA_FAST, o_janos01); //was o_tv
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "... and the best part of all is that when all the dwarfs in the galaxy are in Tir na Nog, Cuchulainn is going to give each and every one of you a prize...");
            scr_event_build_animation_set(o_tv, "beach");
            scr_event_build_animation_set(o_tv2, "beach");
            scr_event_build_camera_frame(CAMERA_FAST, o_janos01);
            scr_event_build_destroy_object(o_dwarf4);
            scr_event_build_dialogue("Janos", "s_port_janos", "NEXT! Get over here!");
     // Everyone in line moves up one space - Hoopz is next to the Janos now.
            scr_event_build_move_ext(o_dwarf6, 0, -140, MOVE_FAST);
            scr_event_build_wait(.1);
            scr_event_build_move_to_point(o_cts_hoopz, queX, queY); //scr_event_build_move_to_point(o_cts_hoopz, 0, -32);
            scr_event_build_wait(.1);
            scr_event_build_move(o_dragline01, 0, -32);
            scr_event_build_wait_for_actions();
            scr_event_build_destroy_object(o_dwarf6);
            scr_event_build_animation_set(o_cts_hoopz, "before_punched");
            ////scr_event_build_visible(o_janos01, false);  // DISAPPEAR DUERGAR
            scr_event_build_animation_set(o_janos01, "shadowKeep");
            scr_event_build_camera_frame(CAMERA_FAST, o_janos01, o_cts_hoopz);
     // Gate Duergar is now part of the s_hoopz_punched Sprite Anim
            scr_event_build_dialogue("Janos", "s_port_janos", "Alright kid, what's your name and where are you from?");
            scr_event_build_dialogue("? ? ?", s_port_hoopz, "I... I don't know.");
            scr_event_build_dialogue("Janos", "s_port_janos", "Not gonna tell me your name, kid?");
            scr_event_build_dialogue("? ? ?", s_port_hoopz, "I don't know my name... I don't remember who I am! I don't know where I am! I just want to go home!");
            scr_event_build_dialogue("Janos", "s_port_janos", "Alright, well if you're not gonna tell me your name...");
            scr_event_build_animation_set(o_tv, "face");
            scr_event_build_animation_set(o_tv2, "face");
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "... can you believe that!? A prize for each and every dwarf! What do you think it will be?!");
            scr_event_build_animation_set(o_tv, "sunset");
            scr_event_build_animation_set(o_tv2, "sunset");
            scr_event_build_dialogue("Janos", "s_port_janos", "... then I'm gonna give you one!");
     // Janos punches Hoopz in the guts, grabs him by the collar, brands the back of his neck with a hot iron and throws 
     // him on the ground. Hoopz lays there.
            scr_event_build_animation_play_and_set(o_cts_hoopz, "punched", "ground"); //This is the branding animation
            scr_event_build_sound_play("sn_hoopzBranded"); 
            scr_event_build_wait_for_actions();
            ////scr_event_build_animation_set(o_janos01, "brandingStand");
            ////scr_event_build_wait(.1);
            ////scr_event_build_visible(o_janos01, true);
            scr_event_build_dialogue("Janos", "s_port_janos", "Heh heh heh, looks like from now on, your name's gonna be...");
            scr_event_build_animation_set(o_tv, "face");
            scr_event_build_animation_set(o_tv2, "face");
            scr_event_build_dialogue("Mounted TV", "s_port_tvGuy01", "... what do you think YOUR prize is going to be?");
            //scr_event_build_animation_set(o_tv, "beach");
            //scr_event_build_animation_set(o_tv2, "beach");
            scr_event_build_camera_frame(CAMERA_NORMAL, o_cts_hoopz);
            scr_event_build_dialogue("Janos", "s_port_janos",  P_NAME + "...");
            
     // The entire screen except for Hoopz's sprite, lying on the ground, fades to black.
     // (bhroom note) the depth controls below are the hacky things that I want to avoid needing to use if possible ...
            //scr_event_build_depth_set(o_cts_hoopz, -3000000);
            scr_event_build_create_object(o_hoopz_black, 0, 0);
            scr_event_build_fade(true, 3);
            scr_event_build_wait(4);
            scr_event_build_dialogue("? ? ?", s_port_hoopz, "... is that... is that me...? Is that who I have to be? Is this who I am...?");
            scr_event_build_wait(2);
            scr_event_build_dialogue("? ? ?", s_port_hoopz, "X__1__1__4__JAM__9__.................................."); //TODO: I added the hard text of "X114JAM9" to see if it looked better, if we have the way to change you name before this, then we should revert
            scr_event_build_wait(1);
            //scr_event_build_fade_etc(true, 2, -5000000);
            //scr_event_build_wait_for_actions();
            scr_event_build_teleport(r_tnn_wilmer02, 228 + 2, 136 - 4, 0, -2); //-2 cuts out room fade, and maks the black at start work on next
        }
        scr_event_advance(event);
    }
}
