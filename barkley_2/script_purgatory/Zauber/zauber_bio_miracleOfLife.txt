/// zauber_bio_miracleOfLife(command, caster, aim_x, aim_y, aim_z)

// ----- Zauber configurations -----

/* PIETY EFFECT: HP per absorbed damage = ABSORB_RATIO_BASE + ABSORB_RATIO_PIETY_MULT * piety */
// HP per absorbed damage ratio
var ABSORB_RATIO_BASE = 0.2;
// HP per absorbed damage piety multiplier
var ABSORB_RATIO_PIETY_MULT = 0.008;

// Number of walls (must be an odd number)
var ABSORB_RADIUS = 160;


// ----- Input arguments -----
var command = argument0;
var caster = argument1;
var aim_x = argument2;
var aim_y = argument3;
var aim_z = argument4;

// ----- Commands -----
if (command == "element") return "BIO";
if (command == "name") return "MIRACLE OF LIFE";

if (command == "aim_decals") {
    // Place decals when aiming
    // TODO Should mark all wall positions
    scr_fx_decal_transient(s_zauberCasting_circle, 1, aim_x, aim_y, aim_z,
                           0.25, 0.25 * 0.7,
                           0, c_white, 0.5);
    scr_fx_decal_transient(s_zauberCasting_target, 1, aim_x, aim_y + 8, aim_z, 1, 1, 0, c_white, 1)
}

if (command == "cast") {
    // Cast the zauber! Do whatever you want here
    if (isCombatActor(caster)) {
        var piety = scr_stats_getEffectiveStat(caster, STAT_BASE_PIETY);
        
        // TODO: Fail cast if diff between z and base_z is too great
        var flower = instance_create(aim_x, aim_y, o_zauber_bio_miracleOfLife);
        flower.absorb_ratio = ABSORB_RATIO_BASE + ABSORB_RATIO_PIETY_MULT * piety;
        flower.absorb_radius = ABSORB_RADIUS;
    }
}