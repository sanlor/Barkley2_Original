<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>s_kalevi02</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>InteractiveActor</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Inheritance //
event_inherited();

scr_event_hook_onCommon(event_cinema)

// Blacksmithing Animation
scr_entity_animation_new("default");
scr_entity_animation_setSpeed("default", 0); // Two frames per 0.1s

// Standing Frame
scr_entity_animation_define("kaleviStanding", s_kalevi01, 0, 0, 0);

// Gone to the mines //
if Quest("govKalevi") &gt;= 4 and scr_area_get() == "tnn" then scr_event_interactive_deactivate();
if Quest("govKalevi") &lt;= 3 and scr_area_get() == "min" then scr_event_interactive_deactivate();

// Check if Inside, if so change Kalevi's animation to "standing" and check for existence of curfew
if scr_inside() == true then
    {
    scr_entity_animation_set(o_kalevi02, "kaleviStanding");
    if scr_time_db("tnnCurfew") == "before" or scr_time_db("tnnCurfew") == "after" then scr_event_interactive_deactivate();
    }
else
    {
    // Activation &amp; Deactivation for Curfew Outside
    if scr_time_db("tnnCurfew") == "during" then scr_event_interactive_deactivate();
    }

//If Kalevi is in the Market District he should be smithing
if (script_execute(scr_inside) == false)
{
    audioemit = audio_emitter_create();
    audio_emitter_falloff(audioemit,80,300,1);
    audio_emitter_gain(audioemit,1 * global.sfx_gain_master);
    audio_emitter_position(audioemit,x,y,0);
    
    //Better collision box for Kalevi
    y -= 12;
    scr_entity_setMovementCollisionShape_rectangle(60, 20);
    y += 12;
    shadow_radius = 12;
    shadow_sprite_offset_x = -23;
    shadow_sprite_offset_y = -13;
    
    curImg = 0;
    timerfrm =0;
    animInterv = 6;
}

// Either TNN or Mines interaction //
if room = r_min_kaleviCave01 then event_user(2);
else event_user(1);


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();

if (paused()) exit;

// Only controls Kalevi if he's in the Market Blacksmithing
if (room == r_tnn_marketDistrict01 || room == r_min_kaleviCave01) 
{    
    if(timerfrm&lt;animInterv)
    {
        timerfrm+=5*dt();
    }
    else
    {
        timerfrm -= animInterv;
        image_index+=1;
        curImg = image_index;
        event_user(5);
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="15">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Kalevi Animations
//curImg = scr_entity_animation_getImage("default");
if _active = true then
    {
    switch(curImg)
        {
            case 3:
                if(scr_time_get() != 3)
                {
                    el = audio_play_sound_on_ext(audioemit,"sn_blacksmith_clang",false,85);
                    audio_sound_pitch(el,0.7+random(0.5));
                }
                break;
            case 8:
                if(random(10)&lt;4){animInterv = 3+irandom(2); curImg = 0;} ///do two clunks in a row, faster
                else {animInterv = 4+irandom(4); curImg = 0;} ///wait before next flip/blink
                break;
        } 
    }

image_index = curImg;
scr_entity_animation_setFrame("default",curImg);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="12">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>script =
"
KNOW_KALEVI
DIALOG | Kalevi | Ah, a new arrival, eh? Here's a little tip from your friendly neighbourhood blacksmith: Don't let the duergar beatings get to you, youngster. You will get used to them eventually.
DIALOG | P_NAME | Hey, you're Kalevi, right? From Tir na nog?
DIALOG | Kalevi | Aye, that's me. You look a bit familiar yourself, youngster. I take it that we've met before?
DIALOG | P_NAME | Yeah, that's right. How come you're here in the mines, mister Kalevi?
DIALOG | Kalevi | Heh, believe it or not but the governor himself assigned me here not too long ago.
DIALOG | P_NAME | (Oh, that's right...)
DIALOG | Kalevi | I take it that you were assigned here as well? Those blue brutes must have maimed one slave too many if they are shipping new recruits all the way from tir na nog.
DIALOG | P_NAME | Actually, I'm... Uh, nary ye mind.
DIALOG | Kalevi | Oh? Suit yourself, youngster. I don't really care either way. All I care about is swinging this hammer.
GOTO   | KALEVI_QUESTIONS

KALEVI_QUESTIONS
CHOICE | Ask Kalevi something?
REPLY  | KALE_MAKE  | What are you working on?
REPLY  | KALE_MINES | What do you know about the mines?
REPLY  | KALE_GUNS  | Can you make a gun for me?
REPLY  | KALE_LEAVE | I'd better keep going.

KALE_MAKE
DIALOG | P_NAME | What are you working on?
DIALOG | Kalevi | Oh, I'm just making some repairs for the mining equipment. It's surprising how fast pickaxes can break down.
DIALOG | Kalevi | Is there something else you wanted?
GOTO   | KALEVI_QUESTIONS

KALE_MINES
DIALOG | P_NAME | What do you know about the mines?
DIALOG | Kalevi | What's there to know? Cuchulainn had this place dug open ages ago in hopes of finding some relic, or whatever he was after. 
DIALOG | Kalevi | Couple of days ago they brought in a lot more duergars down here to crack the whip on those big nosed guys. Most of the operations were moved out of the `kw`Beta Camp,`rt` and into other parts of the mines. Beta Camp is where we are right now, the big open area just outside my quarters.
DIALOG | P_NAME | So what does it mean that they did all that?
DIALOG | Kalevi | Beats me. I guess they found what they were looking for and moved on to something else.
DIALOG | Kalevi | Is there something else you wanted?
GOTO   | KALEVI_QUESTIONS

KALE_GUNS
DIALOG | P_NAME | Can you make a gun for me?
DIALOG | Kalevi | Hah! You want me to work on some brastware?
DIALOG | P_NAME | Yeah. I bet a skilled craftsman like you could make some truly epic gun's.
DIALOG | Kalevi | Oh, I know how to make some proper gun's alright, but with all these duergars down here my chances of not getting caught are close to nil. No dice, buddy.
DIALOG | P_NAME | Aw, shucks...
DIALOG | Kalevi | Is there something else you wanted?
GOTO   | KALEVI_QUESTIONS

KALE_LEAVE
DIALOG | P_NAME | It was nice chatting with you but I'd better keep moving.
DIALOG | Kalevi | Alright, if you say so.
";
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>script =
"
IF body == governor | IF govKalevi == 0 | GOTO | GOVNAH0
IF body == governor | GOTO | GOVNAH1
IF wilmerEvict == 1 | IF kaleviHousingDept == 0 | GOTO | ASKHOUSING1
IF wilmerEvict == 1 | IF kaleviHousingDept == 1 | GOTO | ASKHOUSING2
IF ericQuest == 2 | IF kaleviJobSearch == 0 | GOTO | ERICJOB
IF govKalevi == 0 | IF kaleviTalked == 0 | IF curfew != during | GOTO | ANVIL1
IF govKalevi == 0 | IF kaleviTalked == 1 | IF curfew == before | IF kaleviGun1Given == 0 | GOTO | GUNGIVE
IF govKalevi == 0 | IF kaleviTalked == 1 | IF curfew != during | GOTO | ANVIL2
IF govKalevi == 0 | IF kaleviState == 0 | IF curfew == during | GOTO | TNNSUCKS1
IF govKalevi == 0 | IF kaleviState == 1 | IF curfew == during | GOTO | TNNSUCKS2
IF govKalevi == 1 | GOTO | DESIRE
IF govKalevi == 2 | IF curfew == during | GOTO | MINESPACKING
IF govKalevi == 2 | IF curfew == after | GOTO | MINESFINISH
IF govKalevi == 3 | GOTO | MINESFAREELL

GOVNAH0
DIALOG | Kalevi | Eh, you're the new Governor then, are you? Askin' humbly, sir... I don't mind making nails and pipes for the Duergars, but what I wouldn't give to work on gun's again...
QUEST  | govKalevi = 1

GOVNAH1
DIALOG | Kalevi | Yes sir, I'm the blacksmith around here. Actually, I'm a trained gun'ssmith but the old Governor didn't let me work my craft, at least not for dwarfs. Been doing this for all my life and I learned from the gun'ssmithing masters themselves. What I wouldn't give to work on 'zook's again, to feel molten Damascus steel bending under the blows of my hammer just one last time...

ASKHOUSING1
DIALOG | Kalevi | Season's Greeting's youngster. What can I do for you?
DIALOG | P_NAME | I'm actually looking for the Housing Department.
DIALOG | Kalevi | Ha! Good luck if you can stand the wait. It's over in the Warehouse District, pretty much on the other side of the Governor's Mansion in the center of town. Probably should hurry though, their hours are less than accomodating and their late fees hit harder than my hammer.
DIALOG | P_NAME | Oh that's really good to know, thanks!
QUEST  | kaleviHousingDept = 1

ASKHOUSING2
DIALOG | Kalevi | Watch your step, youngster. I'm about to blast the heck out of this pipe.

ERICJOB
CHOICE | Hey mister Kalevi...
REPLY  | GOTJOB | Any jobs available?
REPLY  | NARY   | Nary ye mind...

GOTJOB
DIALOG | P_NAME | Excuse me, do you have any jobs available?
DIALOG | Kalevi | Think you can pound molten steel with a 20 pound hammer in front of a raging furnace all day long?
DIALOG | P_NAME | Oh, I'm looking for a friend, not me.
DIALOG | Kalevi | Well can your friend do it?
DIALOG | P_NAME | Mmm... no, definitely not... one hundred percent definitely not.
DIALOG | Kalevi | Nope. No jobs.
DIALOG | P_NAME | Oh, okay then. Thanks anyway!
QUEST  | kaleviJobSearch = 1
     
NARY            
DIALOG | P_NAME | Nary ye mind, maybe some other time.

ANVIL1
DIALOG | Kalevi | Sure these are just sewage pipes I'm repairing, but with a hot enough flame and a true enough anvil, I could forge a 'zook that would clear a Duergar's arse.
DIALOG | P_NAME | Such raw power... and zook's are...?
DIALOG | Kalevi | Ah, and here I thought the little tyke was a 'braster. Bazookas my boy! I make the finest pop launchers this side of Brain City. But city ordinance keeps me from pounding that ordnance. New rules state that gun's need to be bred, no straight smithing, this keeps us dwarfs from using our true talents. It's a scam. I'm just a glorified plumber while I'm in this dump.
QUEST  | kaleviTalked = 1

GUNGIVE
DIALOG | P_NAME | Gosh Kalevi, it's tough going through life brasting without a trusty 'zook.
DIALOG | Kalevi | Fat chance, kid. I'm not stamping my passport to the labor mines just to break out the 'good stuff'. The only way I'm ending up in the mines is on smithin' contract.
WAIT   | 1
DIALOG | Kalevi | But you know what? I don't think there is much in the rules about givin' away ALREADY SMITHED gun's. Look, I was gonna drop this old pop gun into this sewer pipe once I was done shapin' it, so you might as well take it.
NOTIFY | Got the gun KALE! // TODO: need to get gun added properly
EVENT  | o_kalevi02 | 0
DIALOG | P_NAME | Oh wow I wasn't expecting this! Thanks a lot!
DIALOG | Kalevi | For what, kid? I didn't give you anything. I don't deal in gun's. I'm a straight shooter. That gun you just happened to find though, is anything but straight.
DIALOG | P_NAME | Oh... oh! Right! No thanks to you then... got it!
QUEST  | kaleviGun1Given = 1

ANVIL2
DIALOG | Kalevi | Anvil's hot.

TNNSUCKS1
DIALOG | Kalevi | Hey, I can't say it too loud but... this curfew is just stupid. Why shouldn't I be allowed to work when I want to? I think the Duergars just get off on bossing us around, that's what I think.
QUEST  | govKalevi = 1
QUEST  | kaleviState = 1

TNNSUCKS2
DIALOG | Kalevi | Sigh... what I wouldn't give to get outta this place. To work on gun's again, to have my own schedule, to be my own boss. You know, Tir na Nog sucks.
QUEST  | govKalevi = 1

DESIRE
DIALOG | Kalevi | Yep, I'm the blacksmith around here. Actually, I'm a trained gun'ssmith but the Duergars don't let me work my craft, at least not for dwarfs. Been doing this for all my life and I learned from the gun'ssmithing masters themselves. What I wouldn't give to work on 'zook's again, to feel molten Damascus steel bending under the blows of my hammer just one last time...

MINESPACKING
DIALOG | Kalevi | Sorry, kid, can't talk. I'm packing up my things 'cuz I'm getting transferred to the Duergar Mines, where I'm actually gonna be allowed to work on weapons. You know, they say life at the Mines is pretty rough but I honestly can't wait to work on weapons again. Making these crummy trinkets and tools was driving me crazy.

MINESFINISH
DIALOG | Kalevi | Sorry, kid, can't talk. I'm finishing up my last orders 'cuz I'm getting transferred to the Duergar Mines, where I'm actually gonna be allowed to work on weapons. You know, they say life at the Mines is pretty rough but I honestly can't wait to work on weapons again. Making these crummy trinkets and tools was driving me crazy.

MINESFAREWELL
DIALOG | Kalevi | If you ever end up in the Mines, hit me up. I'll forge you the most hellzapoppin' 'zook's you ever laid eyes on. That's my specialty, bazookas. You can tell I'm serious about bazookas because I have the word /'bazooka/' tattooed to my inner thigh.
";
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Give kalevi gun //
scr_gun_db("kaleviGun1");
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>36,61</point>
    <point>36,36</point>
  </PhysicsShapePoints>
</object>
