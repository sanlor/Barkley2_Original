<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>s_running_mantis</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>InteractiveActor</parentName>
  <maskName>s_pedestrian_mask</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>event_inherited();
scr_entity_animation_define("juice", s_running_mantis_juice, 0, 22, ANIMATION_DEFAULT_SPEED);
scr_entity_animation_define("stand", s_running_mantis_juice, 0, 1, 0);

alp = 0;
col = c_white;

juice_ratio = 0;
juice_bonus = 0;
juiced = false;
juice_animation = 0;

// Adjacents
// 1 = bottom right, 2 = top right, 3 = top left, 0 = bot left
lastWalkFrame = 0;
dusCou = 0;
dusAmt = 10; // 2 per second
active = 0;
life = 6;
move_speed = 10;
wayPntCur = 0;
wayPnt[0, 0] = o_cinema3; wayPnt[0, 1] = o_cinema1;
wayPnt[1, 0] = o_cinema0; wayPnt[1, 1] = o_cinema2;
wayPnt[2, 0] = o_cinema1; wayPnt[2, 1] = o_cinema3;
wayPnt[3, 0] = o_cinema2; wayPnt[3, 1] = o_cinema0;
//event_user(0); // Sets wayPntDes
//if point_distance(x, y, wayPntObj.x, wayPntObj.y) &lt;= 32

//
scr_actor_unsetRigid(id);
scr_path_setMovementType(scr_path_movementType_standard_offset);
scr_path_setWalldist(24);
scr_path_setLookaheadDist(16 + 8);

scr_event_hook_onCommon(event_cinema);
scr_entity_set_pedestrian(s_running_mantis, 0);
// I am a pedestrian and I've got the variable to prove it //
_pedestrian = true;
_automatic_animation = true; // ???
_disableOutline = true;

// Variables for pushing around hoopz and the pedestrian upon collision of the two //
//I am making these guys push hoopz a lot more - bhroom (101315)
push_return_to_origin = 0;
push_return_to_origin_cooldown = 0;
push_return_to_origin_treshold = 0;
pushed_x = 0;
pushed_y = 0;
push_player_force = 1.5;
push_me_force = 1;
push_weight = 1.5 + random_range(0, 2);

if Quest("bossRunningMantis") &gt;= 2 then scr_event_interactive_deactivate();
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Inherit //
event_inherited();

// Pause //
if (paused() || Stat("hp") &lt;= 0) exit;

// Smoke trail
if (x != xprevious || y != yprevious) dusCou += dt_sec();
if (dusCou &gt; 1 / dusAmt) and juice_animation &lt;= 0 then
{
    dusCou -= 1 / dusAmt;
    Smoke("puff", x + 6 - random(12), y + 6 - random(12), 0, 7 + random(3));
}

// Walk sounds
if (lastWalkFrame != round(_last_frame) &amp;&amp; juice_animation &lt;= 0)
{
    if (round(_last_frame) mod 2 == 0) // Is even
    {
        lastWalkFrame = round(_last_frame);
        if (global.event) audio_play_sound_at_xy("bubblepop", false, 10, o_cinema4.x, o_cinema4.y);
        else audio_play_sound_at_xy("bubblepop", false, 10, x, y);
    }
}

if (active == 0) exit;

alp -= dt_sec(); // Hit timer, flash timer (before)

if (point_distance(x, y, wayPntObj.x, wayPntObj.y) &lt;= 24) and juice_animation &lt;= 0 then
{
    wayPntCur = wayPntDes;
    event_user(0);
}

if (place_meeting(x, y, CombatAttackEntity) &amp;&amp; alp &lt;= 0) //o_bullet))
{
    if juice_animation &lt;= 0 then
        {
        // Get goofed //
        life -= 1;
        alp = 1; // The overlay flash alpha
        audio_play_sound_at_xy("duergar_grunt", false, 10, x, y);
        
        // Update path //
        move_speed += 1;
        scr_path_delete();
        scr_path_set(x, y, wayPntObj.x, wayPntObj.y, move_speed + juice_bonus, 0, 30000);
        
        // Mantis is in dire straits //
        if (life &lt;= 3) col = c_red;
        
        // Mantis is killed //
        if (life &lt;= 0) 
            { 
            // Heal up Hoopz when mantis croaks //
            if instance_exists(o_hoopz) then 
                {
                if scr_stats_getCurrentStat(o_hoopz, STAT_CURRENT_HP) &gt; 0 then scr_stats_setCurrentStat(o_hoopz, STAT_CURRENT_HP, scr_stats_getEffectiveStat(o_hoopz, STAT_EFFECTIVE_MAX_HP));
                }
                
            // Stop the gas //
            with o_stageHazard_gasSpawn brast = false;
            
            // He is beat //
            Quest("bossRunningMantis", 2);
            Quest("bossRunningMantisTrigger", 2);
            
            instance_create(x, y, o_runningMantis_death01);
            with o_runningMantis_trigger01 Cinema("run", script);
            show_debug_message("mantis killed"); 
            instance_destroy(); 
            }
        }
        
    // Remove the bullet that hit you //
    with instance_nearest(x, y, CombatAttackEntity) instance_destroy();
}

// While NOT juiced juice ratio goes up, when it reaches 1 Mantis juices //
// While juiced, juice ratio falls to zero, but while this happens Mantis is super fast //
if juiced = false then
    {
    juice_bonus = 0;
    if juice_ratio &lt; 1 then juice_ratio += 0.03 * dt_sec();
    if juice_ratio &gt;= 1 then
        {
        scr_path_delete();
        move_x = 0;
        move_y = 0;
        juice_ratio = 1;
        juiced = true;
        juice_animation = 30;
        _automatic_animation = 0;
        _pedestrian = 0;
        image_xscale = 1;
        Animation("play and set", o_runningMantis01, "juice", "stand");
        
        }
    }
else if juice_animation &lt;= 0 then
    {
    juice_bonus = 8;
    if juice_ratio &gt; 0 then juice_ratio -= 0.1 * dt_sec();
    if juice_ratio &lt;= 0 then
        {
        juice_ratio = 0;
        juiced = false;
        }
    }
    
// Mantis stops and gets juiced, then resumes with super speed //
if juice_animation &gt; 0 then 
    {
    // Tick down //
    juice_animation -= dt();
    
    // Juiced up and ready to run //
    if juice_animation &lt;= 0 then 
        {
        _automatic_animation = true;
        _pedestrian = true;
        
        juice_bonus = 8;
        event_user(0);
        }
    }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Compare points and pick furthest
active = 1;
pd0 = point_distance(wayPnt[wayPntCur, 0].x, wayPnt[wayPntCur, 0].y, PlayerCombatActor.x, PlayerCombatActor.y);
pd1 = point_distance(wayPnt[wayPntCur, 1].x, wayPnt[wayPntCur, 1].y, PlayerCombatActor.x, PlayerCombatActor.y);
if (pd0 &gt; pd1) wayPntObj = wayPnt[wayPntCur, 0];
else wayPntObj = wayPnt[wayPntCur, 1];
if (wayPntObj == o_cinema0) wayPntDes = 0;
if (wayPntObj == o_cinema1) wayPntDes = 1;
if (wayPntObj == o_cinema2) wayPntDes = 2;
if (wayPntObj == o_cinema3) wayPntDes = 3;
scr_path_delete();
scr_path_set(x, y, wayPntObj.x, wayPntObj.y, move_speed + juice_bonus, 0, 30000);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="73">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Draw health and juice meter

// Health bar //
if active != 0 then
    {
    var yPos = 8
    
    // Backdrop //
    draw_set_color(c_black);
    draw_set_alpha(0.25);
    draw_rectangle(view_xview - 2, view_yview + yPos, view_xview + 386, view_yview + yPos + 8, false);
    draw_rectangle(view_xview - 2, view_yview + yPos + 14, view_xview + 386, view_yview + yPos + 18, false);
    
    // Juice meter //    
    if juiced = false then
        {
        if juice_ratio &lt; 1 then draw_set_color(c_white);
        else draw_set_color(c_aqua);
        }
    else draw_set_color(c_red);    
    draw_set_alpha(1);
    draw_line_width(view_xview + 210, view_yview + yPos + 16, view_xview + 210 + 100 * juice_ratio, view_yview + yPos + 16, 5);
    draw_line(view_xview + 310, view_yview + yPos + 13, view_xview + 310, view_yview + yPos + 18);
    
    // Name + Juice meter //
    draw_set_halign(fa_right);
    draw_set_font(global.fn_2);
    draw_set_color(c_white);
    draw_text(view_xview + 200, view_yview + yPos, "Running Mantis");
    draw_set_font(global.fn_small);
    draw_set_color(c_aqua);
    draw_text(view_xview + 200, view_yview + yPos + 14, "JUICE:");
    draw_set_halign(fa_left);
    
    // Hearts //
    for (i=0; i&lt;6; i+=1;) 
        {
        if life &gt; i then draw_sprite(s_mg_runningMantisHeart, 0, view_xview + 220 + i * 14, view_yview + yPos + 6);
        else draw_sprite(s_mg_runningMantisHeart, 1, view_xview + 220 + i * 14, view_yview + yPos + 6);
        }
    }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Blink
if (juice_animation &gt; 0)
{
    EffectZauber(s_running_mantis_juice, _last_frame, dx, dy, 1, 1, c_red);
}
if (alp &lt;= 0) event_inherited();
else
{
    if (lengthdir_x(1, alp * 3600) &gt; 0) event_inherited();
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints>
    <point>14,39</point>
    <point>21,21</point>
  </PhysicsShapePoints>
</object>
