<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>s_stealthControl</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-10000000</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Setup //
eyes = 0;
eyes_timer = 0;
eyes_alpha_goal = 1;
eyes_alpha = -2;
global.stealth_detection = 0;

//Kill this minigame if it isn't during the CSPEAR Holding times
if scr_area_get() = "min" then
    {
    if (Quest("playerBlueFace")) then instance_destroy();
    else instance_create(x, y, o_hud_stealther);    
    }

// Kill this minigame if it isn't the curfew //
if scr_area_get() = "tnn" then
    {
    if (scr_time_db("tnnCurfew") != "during") then instance_destroy();
    else instance_create(x, y, o_hud_stealther);    
    }
    
// Kill this minigame if you aren't sneaking around the prison //
if scr_area_get() = "pri" then
    {
    if (Quest("prisonPatrollers") == 2) instance_destroy();
    else if (Quest("prisonLiberated") == 2 || Quest("prisonPatrollers") == 1) 
    {
        instance_create(x, y, o_hud_stealther);
    }
    else instance_destroy();
    //if (scr_time_db("tnnCurfew") != "during") then instance_destroy();
    //else instance_create(x, y, o_hud_stealther);    
    }

// Kill this minigame if the duergars are dead
if (scr_area_get() = "est")
{
    if Quest("osirisState") &lt;= 2 or Quest("deverauxState") &lt;= 2 then instance_destroy();
    if (Duergar("alive", "osiris") == 0 and Duergar("alive", "deveraux") == 0) then instance_destroy();    
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Pause //
if paused() exit;

//if (instance_exists(o_mg_stealth_detection_ring) == 0) { instance_destroy(); }

// Eyes //
if global.stealth_detection &gt;= 70 then eyes = 0;  
else if global.stealth_detection &gt;= 60 then eyes = 1;
else if global.stealth_detection &gt;= 50 then eyes = 2; 
else if global.stealth_detection &gt;= 40 then eyes = 3; 
else if global.stealth_detection &gt;= 30 then eyes = 4; 
else if global.stealth_detection &gt;= 20 then eyes = 5; 
else if global.stealth_detection &gt;= 10 then eyes = 6; 
else eyes = 6;

// Eyes timer //
if eyes_timer &gt; 0 then eyes_timer -= dt();
else if global.stealth_detection &gt; 0 and global.stealth_detection &lt; 70 then global.stealth_detection -= 1;

// Alert //
if global.stealth_detection &gt;= 70 and eyes_alpha_goal = 1 then
    {
    // Get arrested //
    if scr_area_get() = "tnn" then
        {   
        event_user(1); // Replace patrol with actors
        Cinema("run", script);
        }
    
    // Fight duergs //
    else 
        {
        // Run once, and remove the patrollers //
        event_user(0);
        
        // Music change to battler music //
        //audio_set_bgm("mus_sneakalarmTEMP");
        
        // Show hud
        global.gunPacify = false;
        if instance_exists(o_hud_stealther) then with o_hud_stealther instance_destroy();
        }
    }

// Alpha //
eyes_alpha = Goto(eyes_alpha, eyes_alpha_goal, dt_sec() * 6);

// The Social, don't exist if duergs are dead //
if (Duergar("alive", "osiris") == 0 and Duergar("alive", "deveraux") == 0) then instance_destroy();  
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// DSL + Replace duergs with their ACTOR
eyes_alpha_goal = 0;
global.duergarPatrol = 0;
var coolDuergar = -1;
// Remove the stealth shit, and bring in enemies //
with o_mg_stealth_detection_ring instance_destroy();
with o_mg_stealth_duergar_guard 
{
    instance_destroy();
    coolDuergar = Duergar("spawn actor", name, x, y);
    instance_create(x, y - 42, o_effect_emotebubble);
}
with o_mg_stealth_duergar_eagleeyes 
{
    instance_destroy();
    coolDuergar = Duergar("spawn actor", name, x, y);
    instance_create(x, y - 42, o_effect_emotebubble);
}
with (coolDuergar)
{
    scr_entity_look_object(id, o_hoopz.id);
}
global.duergarPatrol = 1;

// Make marker
//with (o_hoopz) { scr_actor_unsetRigid(id); scr_actor_instantRigid(id); }
var good = -1;
var xxx = o_hoopz.x;
var yyy = o_hoopz.y;
obj = instance_create(xxx, yyy - 32, oCinemaSpecial0);
with (obj) { if (scr_collision_move_contact_solid(0, 0, collision_check) == 0) good = id; }
obj = instance_create(xxx, yyy + 32, oCinemaSpecial1);
with (obj) { if (scr_collision_move_contact_solid(0, 0, collision_check) == 0) good = id; }
obj = instance_create(xxx - 32, yyy, oCinemaSpecial2);
with (obj) { if (scr_collision_move_contact_solid(0, 0, collision_check) == 0) good = id; }
obj = instance_create(xxx + 32, yyy, oCinemaSpecial3);
with (obj) { if (scr_collision_move_contact_solid(0, 0, collision_check) == 0) good = id; }

var dum = instance_create(good.x, good.y, oDummy);
with (oCinemaSpecial0) instance_destroy();
with (oCinemaSpecial1) instance_destroy();
with (oCinemaSpecial2) instance_destroy();
with (oCinemaSpecial3) instance_destroy();

coolObject = dum;

script = "
WAIT | 1
IF room == r_tnn_maingate02             | GOTO | CAUGHT_ONSLOW  
IF room == r_tnn_residentialDistrict01  | GOTO | CAUGHT_OX 
IF room == r_tnn_warehouseDistrict01    | GOTO | CAUGHT_KIM  
IF room == r_tnn_businessDistrict01     | GOTO | CAUGHT_PUANNUM
IF room == r_tnn_bballcourt02           | GOTO | CAUGHT_JANOS
IF room == r_tnn_marketDistrict01       | GOTO | CAUGHT_LUCRETIA

CAUGHT_LUCRETIA
DIALOG | Lucretia | Hey, you!
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Lucretia | You think you can just walk around like a free man? Guess again.
DIALOG | P_NAME | `w1`*Gulp*`w0` H-hey, what's the big idea?
IF gutterEscape == 1 | DIALOG | Lucretia | You're the two pieces of work who just robbed the bank. You've made a big mistake you fuckers. Perhaps a lifetime or two in the Hoosegow will set you straight! `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Lucretia | The curfew is no laughing matter, you punk! It's off to the Hoosegow for you! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

CAUGHT_ONSLOW
DIALOG | Onslow | Hold it!
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Onslow | Hands up in the air, fucker!
DIALOG | P_NAME | `w1`*Gulp*`w0` H-hey, what's the big idea?
IF gutterEscape == 1 | DIALOG | Onslow | Where the fuck do you two think you are going? You are the assholes who robbed the bank, aren't you? You've made me look like a fool... Stealing from right under my nose! Perhaps a couple millenia in the Hoosegow will straighten you fuckers out! `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Onslow | You think the curfew is some sort of a joke, huh? That you can just waltz about? Think again, fucker! You just won yourself a one way ticket to the Hoosegow, for life! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

CAUGHT_OX
DIALOG | Ox     | Hey you there!
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Ox     | What the fuck are you doing outside?
DIALOG | P_NAME | `w1`*Gulp*`w0` Umm...
IF gutterEscape == 1 | DIALOG | Ox | You must be the bankrobbers! Hah, oh this is too good to be true! I'm going to get a juicy promotion for sending the two of you into the Hoosegow! `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Ox | I can't stand looking at your ugly mutt for a second longer. I'm calling the Gank Squad on your sorry ass. Enjoy spending the rest of your life in the Hoosegow! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

CAUGHT_KIM
DIALOG | Kim    | What the frudge?
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Kim    | Oh, you are in a world of hurt right now!
DIALOG | P_NAME | `w1`*Gulp*`w0` N-no...
IF gutterEscape == 1 | DIALOG | Kim | You are the bankrobbers, aren't you? Yeah, who else would be moseying about during curfew but a couple of rats? Say your prayers, fuckers, because you are about to get thrown into the Hoosegow! `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Kim | Time for a reality check, pal. You are going to the Hoosegow, and you are never coming back! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

CAUGHT_PUANNUM
DIALOG | Puannum | Stop!
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Puannum | Where do you think you are going?
DIALOG | P_NAME | `w1`*Gulp*`w0` N-nowhere...
IF gutterEscape == 1 | DIALOG | Puannum | You two are the bankrobbers, aren't you? You thought you could steal from the duergars? Think again! You will have plenty of time for it while you rot in the Hoosegow! `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Puannum | Incorrect pal. You aren't going to Nowhere. You are going... to the Hoosegow! Get fucked, pal! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

CAUGHT_JANOS
DIALOG | Janos  | Stop right there, bucko!
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
WAIT   | 0.5
MOVETO | " + string(coolDuergar) + " | " + string(coolObject) + " | MOVE_FAST
WAIT   | 0
LOOKAT | " + string(coolDuergar) + " | o_cts_hoopz
LOOKAT | o_cts_hoopz | " + string(coolDuergar) + "
DIALOG | Janos  | What the hell do you think you are doing out on the streets during curfew? You are going to get such a beating for this...
DIALOG | P_NAME | `w1`*Gulp*`w0` I... I was just...
IF gutterEscape == 1 | DIALOG | Janos | Wait... You must be the bankrobbers! Oh, how you two are going to SUFFER! I can only dream about the tortures they are going to test out on the two of you in the Hoosegow. `w1`Bwahahahahahahahaha!`w0`
IF gutterEscape == 0 | DIALOG | Janos | Don't I know you from somewhere? Pfft, who cares. You are coming with me, fucker. I'm handing you over to the Gank Squad. You are going to the Hoosegow, bucko, and you are never, ever getting out! `w1`Bwahahahahahahahaha!`w0`
GOTO   | PRISON_BEGIN

PRISON_BEGIN
WAIT   | 0.25
FADE   | 1 | 2.0
WAIT   | 3.0
QUEST  | prisonArrested = 3
IF gutterEscape == 1 | QUEST | prisonArrested = 4
IF gutterEscape == 1 | QUEST | gutterhoundArrest = 1
QUEST  | prisonIntro = 1
" +
//TODO: the music should change to the PRISON MUSIC
"
Teleport | r_pri_prisonGate01 | 464 | 1072
";
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Remove the eyes //
eyes_alpha_goal = 0;
   
// Remove the stealth shit, and bring in enemies //
with o_mg_stealth_detection_ring instance_destroy();
with o_mg_stealth_duergar_guard 
    {
    instance_create(x, y - 42, o_effect_emotebubble);
    timer_change = 10;
    scr_path_delete();
    move_x = 0;
    move_y = 0;
    }
with o_mg_stealth_duergar_eagleeyes 
    {
    instance_create(x, y - 42, o_effect_emotebubble);
    timer_change = 10;
    scr_path_delete();
    move_x = 0;
    move_y = 0;
    }
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>// Draw stealth bars //
if (global.event) exit;
draw_set_color(c_black);
draw_set_alpha(0.35 * eyes_alpha);
draw_rectangle(view_xview - 2, view_yview + 4, view_xview + 386, view_yview + 12, false);
draw_rectangle(view_xview - 2, view_yview + 224, view_xview + 386, view_yview + 232, false);

// Stealth text //
draw_set_font(global.fn_small);
draw_set_color(c_white);
draw_set_alpha(0.8 * eyes_alpha);
draw_set_halign(1);
draw_text(view_xview + 192, view_yview + 6, "STEALTH MODE");
if (scr_area_get() == "tnn") draw_text(view_xview + 192, view_yview + 226, "RULES OF ENGAGEMENT: HOOSEGOW ON SIGHT");
else draw_text(view_xview + 192, view_yview + 226, "RULES OF ENGAGEMENT: BRAST ON SIGHT");
draw_set_halign(0);

// Draw eyes //
draw_sprite_ext(s_mg_stealth_eye, eyes, view_xview + 170, view_yview + 20, 1, 1, 0, c_white, eyes_alpha);
draw_sprite_ext(s_mg_stealth_eye, eyes, view_xview + 384 - 170, view_yview + 20, 1, 1, 0, c_white, eyes_alpha);
draw_sprite_ext(s_mg_stealth_nose, 0, view_xview + 192, view_yview + 40, 1, 1, 0, c_white, eyes_alpha);
draw_set_alpha(1);
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
