<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>s_guilderGald01</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>EnemyCombatActor</parentName>
  <maskName>mask_disk_20by20</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Create
event_inherited();

lifedraw = 0; // Disable health bar
ailmentTotem_define(id, 0, 24, 16, 44); // Legit

// Poke attack
attackTimer = 0;
attackFrequency = 0.2; // Every X seconds
attackMelee = ds_map_create();
Attack("assign", attackMelee, "poke", 0.5, 0, 0, 0, 0.5, 0);

// Single coin damage
attackCoin = ds_map_create();
Attack("assign", attackCoin, "coin", 0.5, 0, 0, 0, 0.5, 0);

cinemaDead = 0;
cinema = 1;
mul = 0;
mulSpd = 0;

if (instance_exists(o_room_darkarea))
{
    light = Light("add", id, 96, .2, merge_color(c_black, global.colorGuilderberg, 0));
}
else light = -999;

bob = 0; // bobbing up and down
zht = 16; // z to be in air

sub = 0;
subSpd = 10;

float_y = y;
y_min = 96;

proRep = 1;
proAct = 1;
proPat = 0; // pattern
proSwr = 0; // for pat2
proSwrDir = 1;
proTim = 3;
proPau = 1;
proSec = 4 * 3; // 4 * 4 is old - Projectiles a second
proCou = 0;
proDmg = 1;

// Enemy stats
scr_entity_setShadowCircle(12);
scr_enemyDB_statsGet(enemyBuild);
scr_entity_setCollisionType(COLLISION_ALL);
scr_path_setMovementType(scr_path_movementType_standard);
scr_path_setLookaheadDist(20);
scr_stats_knockback_setKnockbackHandler(scr_stats_knockbackHandler_none);
scr_AI_aggro_configure(120, 200, 800);
scr_entity_setZHitbox(0, 50);

mvyDir = 0;
mvyLen = 32; //96;


deathSound = "cGremlinSmall_death";
damageSound = "cGremlinSmall_grunt";

var conf, attacks, attack, guard;
guard = scr_AI_addPassiveState(scr_AI_passive_none);
guard[? "sndAlertSound"] = "cGremlinSmall_alert";

// Stagger
staggerX = 0;
staggerY = 0;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="1" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Delete light
if (light != -999) Light("delete", light);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Bobbing
event_inherited();

if (paused()) exit;

mul = Goto(mul, 1, mulSpd * dt_sec());
z = (zht - (sin(bob) * 3)) * mul;
bob += dt() * 0.33;
Light("y", light, -(z * 2));
if (mul != 1) Light("color", light, merge_color(c_black, global.colorGuilderberg, 0.33 * mul));

if (mul != 0) sub += subSpd * dt_sec();
if (scr_stats_getCurrentStat(id, STAT_CURRENT_STAGGER_TIME) &gt; 0) exit;
if (cinema) exit;

// Boss bar
hlt = abs(scr_stats_getCurrentStat(o_enemy_guilder_gald, STAT_CURRENT_HP) - scr_stats_getEffectiveStat(o_enemy_guilder_gald, STAT_EFFECTIVE_MAX_HP));
hlt += abs(scr_stats_getCurrentStat(o_enemy_guilder_von_miser, STAT_CURRENT_HP) - scr_stats_getEffectiveStat(o_enemy_guilder_von_miser, STAT_EFFECTIVE_MAX_HP));
hltPct = (1 / global.bossHealth) * abs(hlt - global.bossHealth);
if (hltPct &lt; 0.25 &amp;&amp; cinemaDead == 0) event_user(15);
Quest("marqueeBossHealth", hltPct);

// Speed
actualSpeed = (scr_stats_getEffectiveStat(id, STAT_BASE_AGILE) / scr_stats_getBaseStat(id, STAT_BASE_AGILE));
actualSpeed += (scr_stats_getBaseStat(id, STAT_BASE_WEIGHT) / scr_stats_getEffectiveStat(id, STAT_BASE_WEIGHT));
actualSpeed /= 2;
actualSpeed *= 30;
mvySpd = actualSpeed;
float_y_spd = actualSpeed;

float_y = Goto(float_y, o_hoopz.y - 112, float_y_spd * dt_sec());
y = float_y + lengthdir_y(mvyLen, mvyDir);
y = clamp(y, o_cinema30.y + 8, o_cinema31.y);
mvyDir += mvySpd * dt_sec();

/*
proTim -= dt_sec();
if (proTim &lt;= 0)
{
    proAct = 0;
    proPau -= dt_sec();
    if (proPau &lt;= 0)
    {
        proPau = 1;
        proTim = 1.5;
        proPat = choose(0, 1, 2);
        if (point_distance(x, y, o_hoopz.x, o_hoopz.y) &lt; 80)
        {
            proPat = 3;
        }
        proSwr = 0;
        proAct = 1;
        proCou = 0;
    }
}
*/
if (proPau &gt; 0)
{
    proPau -= dt_sec();
    if (proPau &lt;= 0) proAct = 1;
}
if (proAct)
{
    if (proPat == 0 || proPat == 1)
    {
        proCou += dt_sec() * proSec;
        while (proCou &gt; 4)
        {
            proCou -= 4;
            audio_play_sound_AI("hoopz_pickupMoney");
            cdr = 270 - 25 - 15; // added -15
            if (proPat == 1) cdr += 17.5;
            for (i = 0; i &lt; 4; i += 1)
            {
                event_user(10); // Create coin
                cdr += 35;
            }
        }
        proTim += dt_sec();
        if (proTim &gt;= 1) 
        {
            proPat = !proPat;
            proTim = 0;
            if (proRep == 0) event_user(5);
            else { proPau = 1; proAct = 0; }
            proRep = 0;
        }
    }
    // Swirl
    else if (proPat == 2)
    {
        if (proSwrDir &gt; 0) 
        {
            proSwr += proSwrDir * 50 * dt_sec() * 3;
            if (proSwr &gt; 50) proSwrDir = -1;
        }
        else
        {
            proSwr += proSwrDir * 50 * dt_sec() * 3;
            if (proSwr &lt; 0) proSwrDir = 1;
        }
        proCou += dt_sec() * proSec;
        while (proCou &gt; 1)
        {
            audio_play_sound_AI("hoopz_pickupMoney");
            cdr = 270 - 25 + proSwr;
            for (i = 0; i &lt; 1; i += 1)
            {
                proCou -= 1;
                event_user(10); // Create coin
            }
        }
        proTim += dt_sec();
        if (proTim &gt;= 1.5) event_user(5);
    }
    else if (proPat == 3)
    {
        proCou += dt_sec() * (proSec / 10);
        while (proCou &gt; 1)
        {
            audio_play_sound_AI("hoopz_pickupMoney");
            proCou -= 1;
            cdr = 180 - 40;
            for (i = 0; i &lt; 18 + 8; i += 1)
            {
                event_user(10); // Create coin
                pro.follow_dist = 112;
                cdr += 10;
            }
        }
        proTim += dt_sec();
        if (proTim &gt;= 1.5) event_user(5);
    }
    // Sideswipe
    else if (proPat == 4)
    {
        proCou += dt_sec() * proSec * 2;
        while (proCou &gt; 5)
        {
            proCou -= 5;
            audio_play_sound_AI("hoopz_pickupMoney");
            cdr = 270; // added -15
            for (i = 0; i &lt; 5; i += 1)
            {
                event_user(10); // Create coin
                cdr += 25;
            }
        }
        proTim += dt_sec();
        if (proTim &gt;= 1.5) 
        {
            event_user(5);
        }
    }
}

// Attack
attackTimer -= dt_sec();
if (attackTimer &lt;= 0)
{
    attackTimer += attackFrequency;
    event_user(0);
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="25">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// End Cinema
cinemaDead = 1;
//TODO: this should end at the 25% mark of the fight and then immediately cut to this scene.
script = "
FADE   | 1 | 0.5
WAIT   | 1.5
EVENT  | o_enemy_guilder_gald | 14
Camera | snap | o_cinema2
FRAME  | CAMERA_FAST | o_cinema2
FADE   | 0 | 2
WAIT   | 2
DIALOG | Bhroom | Congrats, you won the fight. At this point the fight should `kw`pause`rt` as best it can while keeping player and enemy alive. Whenever it is safe, it should run this event, that hopefully can be located in either the cutscene script or Gothbard's InteractiveActor.
GOTO | GUILDER_BESTED

GUILDER_BESTED
DIALOG | Gothbard | Stop this at once!
WAIT | 0.25
SURPRISEAT | o_cinema2
FRAME | CAMERA_FAST | o_cinema2
DIALOG | Von Miser | Gothbard, your excellency!
DIALOG | Gald | Sir, what are you doing here!? You should have stayed hidden! If you had perished here-
DIALOG | Gothbard | Hm? If I perished?
" +
//TODO: Gothbard steps into the light.
"
DIALOG | Gothbard | It is you fools who certainly would have perished if I did not stop you.
" +
//TODO: offscreen, have von miser and gald either de-glow and fly up, or fly up, then deglow and land
//TODO: up to you implemented how to do this, but maybe snap Hoopz offscreen to a closer cinema, then walk up into view
//TODO: FRAME | all participants
"
MOVETO | o_cts_hoopz | o_cinema22
DIALOG | Gothbard | Look... look at the youngster's prideful stance, that aura of confidence... the engorged billfold...
DIALOG | Gald | By the heavenly dollar... the precious yuan...
DIALOG | Von Miser | It's true then... the child is one of us!   
DIALOG | Gothbard | Indeed. P_NAME_F, I have been watching you for some time now. Heed what I am about to tell you, for this is the true nature of the world. We are esteemed bankers, and having surveyed the market, found it similar to a great, endless ocean; purchases make ripples, the flow of goods and services form currents, and supply and demand ebb and flow like the tides. Where money gathers in masses, we find vast pools of wealth. Like that trash island in the Pacific.
WAIT | 0
LOOKAT | o_cts_hoopz | o_cinema2
DIALOG | P_NAME = s_port_hoopzSad | (Why are we so careless with our oceans...?)
DIALOG | Gothbard | I have felt your liquid presence in the market, child. I have examined your bankroll and inspected your soulful ledger. You have done more than ever could have been anticipated by one so young. You are becoming a master of money, child, a titan of capital!
DIALOG | P_NAME = s_port_hoopzAngry | Why are you saying this? Who are you?
DIALOG | Gothbard | My moniker in this world is `kw`Gothbard.`rt` My coworkers often called `kw`Gald`rt`_ and `kw`Von Miser.`rt` We are bankers, investors, traders, and lenders. To some, we are known as `kw`Guilderberg Group.`rt` To others, `kw`d.b.a. Guilderberg Holdings, L.L.C.`rt` We believe in the power of the coin and have invested our lives to protecting and nurturing this power. As for you, we desire nothing more than to see your pockets grow ever deeper. Here... a gift...
" +
//TODO: the GOLD COLLAR floats down from the ceiling, hovers in front of P_NAME
//TODO: FOLLOWFRAME | gold collar and P_NAME
"
CREATE | o_guilderCollar01 | 216 | -24
MOVETO | o_guilderCollar01 | o_cinema21 | MOVE_NORMAL
" +
//TODO: SOUNDLOOP of "bwow-bwow" power hum of Collar
"
DIALOG | P_NAME = s_port_hoopzSurprise | Is that..._?
SURPRISEAT | o_cinema21
DIALOG | P_NAME = s_port_hoopzShock | `w2`INCAN GOLD!`w0`
DIALOG | Gothbard | Indeed it is... The truest standard of wealth. Take it P_NAME_S. Consider it a_ `w1`free_ lunch.`w0`
DIALOG | P_NAME = s_port_hoopzSurprise | The glitter... the glean... Incan Gold. I want the Incan Gold.
DIALOG | Gothbard | This is capitalism, P_NAME_S. What one wants._._._ `s1`one T_A_K_E_S!`s0`
" +
//TODO: Hoopz reaches for the collar and it separates and wraps around Hoopz' neck!
//TODO: some smoke arises from Hoopz, then settles, Hoopz is now in "collared" sprite mode... which is nothing but a Portrait swap
"
NOTIFY | Gained Pachacuti's Choker
NOTIFY | FREE WILL has been supplanted!
ITEM | Pachacuti's Choker | 1
DIALOG | Gothbard | Now, there are great secrets of money that still elude you. These secrets are the protected intellectual property of Guilderberg Group. I hereby invite you to join us, P_NAME_S. Forget about the commoners below, and put your faith in us,_ and in the almighty coin. Accept our offer... or your life - and profits - end here.
CHOICE | Join Guilderberg Group?
REPLY | JOIN_YES | I'll invest.
REPLY | JOIN_YES | I'll divest.

" +
//TODO: go in and set all portraits to the COLLARED portrait
"
JOIN_YES
DIALOG | P_NAME | Your shining suit and fine words have convinced me. Tell me what I can do about my credit. I don't know what a promissory note is, but I'm afraid I need one. How is my portfolio doing?
DIALOG | Gothbard | Very good, child. There will be time for all of your questions to be answered. For now, I must resume my rest. Von Miser and Gald will assist you with anything you need, and you will assist them as well. Welcome, P_NAME.
DIALOG | Gothbard | ... Welcome to the family.
"
//TODO: Gothbard slinks back into the darkness.
Cinema("run", script);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="24">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Reset code
Quest("marqueeBossName", 0);
with (oBossGuilderbergCoin) instance_destroy();
with (oZauberSparkle) instance_destroy();
with (o_enemy_guilder_gald)
{
    x = xstart;
    y = ystart;
    mul = 0;
    mulSpd = 0;
    cinema = 1;
}
with (o_enemy_guilder_von_miser)
{
    x = xstart;
    y = ystart;
    mul = 0;
    mulSpd = 0;
    cinema = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="20">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Create Coin
pro = instance_create(x, y, oBossGuilderbergCoin);
pro.z = zht + 8;
pro.scl = 0.25;
with (pro) event_user(15);
//scr_stats_setAttackStat(pro, STAT_ATTACK_DMG_ZAUBER, proDmg);
Attack("damage", id, attackCoin, pro);
ds_list_copy(pro.target_list, target_list);
pro.dir = cdr;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="15">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Change state
proTim = 0;
proAct = 0;
proPau = 1;
proPat = choose(0, 1, 2);
if (o_hoopz.x &gt; oBossGuilderbergTable.x + 64) proPat = 4
if (point_distance(x, y, o_hoopz.x, o_hoopz.y) &lt; 80)
{
    proPat = 3;
}
if (proPat &lt;= 1)
{
    proRep = 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="12">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Mul speed
mulSpd = 1;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="11">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Cinema stop
cinema = 0;
global.battleMode = 1;
global.bossHealth = scr_stats_getEffectiveStat(o_enemy_guilder_von_miser, STAT_EFFECTIVE_MAX_HP);
global.bossHealth += scr_stats_getEffectiveStat(o_enemy_guilder_gald, STAT_EFFECTIVE_MAX_HP);
scr_stats_setBaseStat(o_enemy_guilder_von_miser, STAT_BASE_HP, 99999);
scr_stats_setBaseStat(o_enemy_guilder_gald, STAT_BASE_HP, 99999);
with (o_enemy_guilder_von_miser) scr_stats_genEffectiveStats();
with (o_enemy_guilder_gald) scr_stats_genEffectiveStats();
Quest("marqueeBossName", "GUILDERBERGS ");
Quest("marqueeBossHealth", 1);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="10">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Push attack
var n, ax, ay, _dist;
n = instance_create(x, y, o_enemyAttack_melee_static)
n.z = z;
n.parent = id;
n.attack_from = id;
n.lifetime = 2;
n.mask_index = mask_disk_32by32;
ds_list_copy(n.target_list, target_list);
Attack("damage", id, attackMelee, n);             
n.knockback_dir = point_direction(x, y, o_hoopz.x, o_hoopz.y);
scr_stats_setAttackStat(n, STAT_ATTACK_KNOCKBACK, 15);
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Draw
event_inherited();

if (mul == 0) ssb = 0;
else ssb = 1 + (sub mod 4);
var zau = 1;
var stg = scr_stats_getCurrentStat(id, STAT_CURRENT_STAGGER_TIME);
if (stg &gt; 0) 
{
    zau = 0.5;
    if (paused() == 0)
    {
        staggerX = - (stg / 2) + random(stg);
        staggerY = - (stg / 2) + random(stg);
    }
}
else
{
    staggerX = 0;
    staggerY = 0;
}
var drx = dx + staggerX;
var dry = dy + staggerY;
EffectZauber(sprite_index, ssb, drx, dry, 1, 1, global.colorGuilderberg, mul * zau);
draw_sprite_ext(sprite_index, ssb, drx, dry, 1, 1, 0, c_white, 1);

combatActor_draw_post();
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
